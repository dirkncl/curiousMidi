<!DOCTYPE html>
<html>
	<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>curiousMidi</title>
		<style type="text/css">
      
label.filebutton {
    width:120px;
    height:5px;
    position:relative;
    background-color:#eee;
    color:black;
}

label span input {
    z-index: 999;
    line-height: 0;
    font-size: 10px;
    position: absolute;
    top: -2px;
    left: -700px;
    opacity: 0;
    filter: alpha(opacity = 0);
    -ms-filter: "alpha(opacity=0)";
    cursor: pointer;
    _cursor: hand;
    margin: 0;
    padding:0;
}
		</style>
    <style>

.svg-icon {
  width: 1em;
  height: 1em;
}

.svg-icon path,
.svg-icon polygon,
.svg-icon rect {
  fill: #4691f6;
}

.svg-icon circle {
  stroke: #4691f6;
  stroke-width: 1;
}
#search {
  display:none;
  position: relative;
  top: 0;
  z-index: 9;
}
#search input {
  height: 100%;
  width:380px;
  outline: ;
  background:gold;
  color: #131313;
  font-size: 1em;
}

::-webkit-input-placeholder {
   color: rgba(0,0,0,0.4);
}

:-moz-placeholder { /* Firefox 18- */
   color: rgba(0,0,0,0.4);
}

::-moz-placeholder {  /* Firefox 19+ */
   color: rgba(0,0,0,0.4);
}

:-ms-input-placeholder {  
   color: rgba(0,0,0,0.4);
}


#togglesongholder { 
  position: Absolute;
  /*width: 20%;*/
  top:0%;
  text-align:center
}
#songs {
  position: Absolute;
  background: rgba(117,91,48, 1);
  /*-webkit-animation: pulse 80s infinite alternate;*/
  /*width: 20%;*/
  height: 80%;
  top:20%;
  overflow: scroll;
  padding-left: 5px;
  /*bottom: 5%;*/
}
@-webkit-keyframes pulse {
0% {background-color: rgba(248,117,117, 1);}
25% {background-color: rgba(217,171,255, 1);}
50% {background-color: rgba(243,248,117, 1);}
75% {background-color: rgba(165,248,117, 1);}
100% {background-color: rgba(117,191,248, 1);}
}

#songs table {
  width: 100%;
  text-align:left;
  
}
table tr:hover {
  background: rgba(255,255,255,0.4);
  border-radius: 5px;
  color: #131313;
  padding: 20px 0;
}
table tr {
  padding: 10px 0;
  -webkit-user-select: none;
  user-select: none;
  cursor: default;
}
table td {
  padding-top: 3px;
  padding-bottom: 3px;
  padding-right: 5px;
}


#playlist table tr.playing {
  font-style: italic;
}

#songs table tr.playing {
  background: #76AD8B;
  font-style: italic;
}


#playlist table tr.playing td {
  padding-left: 50px;
}


tr.hidden {
  display:none;
}

/*scroll bar*/
::-webkit-scrollbar {
  width: 5px;
  height: 0px;
}
::-webkit-scrollbar-thumb {
  background-color: rgba(100,170,200, 1);
  border-radius: 0 1px 1px 0;
  
}
::-webkit-scrollbar-track {
  background: rgba(117,191,248, 0.5);
}


#mydiv {
  position: absolute;
  z-index: 9;
  width: 400px;
  height:80%;
  left:350px;
  border:none;
}

#mydivheader {
  padding: 10px;
  cursor: move;
  z-index: 10;
  color: #fff;
  height:50px;
  background: rgba(117,91,48, 1);
  
  
}
    </style>

    <script>
    
    Mobile=/Android|webOS|iPhone|iPad|iPod/i.test(navigator.userAgent);
    
    var search='<svg class="svg-icon" viewBox="0 0 20 20"><path d="M18.125,15.804l-4.038-4.037c0.675-1.079,1.012-2.308,1.01-3.534C15.089,4.62,12.199,1.75,8.584,1.75C4.815,1.75,1.982,4.726,2,8.286c0.021,3.577,2.908,6.549,6.578,6.549c1.241,0,2.417-0.347,3.44-0.985l4.032,4.026c0.167,0.166,0.43,0.166,0.596,0l1.479-1.478C18.292,16.234,18.292,15.968,18.125,15.804 M8.578,13.99c-3.198,0-5.716-2.593-5.733-5.71c-0.017-3.084,2.438-5.686,5.74-5.686c3.197,0,5.625,2.493,5.64,5.624C14.242,11.548,11.621,13.99,8.578,13.99 M16.349,16.981l-3.637-3.635c0.131-0.11,0.721-0.695,0.876-0.884l3.642,3.639L16.349,16.981z"></path></svg>';
      window.M3U={};
      var fileName = "midiCollection.m3u";
      parser = function(m3uData){
        Data=m3uData.replace(/\r/g,"");
        return (
          Data.substr(0,Data.search("\n"))==="#EXTM3U"?
            Data.substr(Data.search("\n"))
                .split("\n#")
                .filter(function(a){return!!a.trim().length})
                .map(function(e){
                  var c;
                  return (
                    c=e.match(/:(?:(-?\d+),(.+)\s*-\s*(.+)|(.+))\n(.+)/),
                    c&&6===c.length?
                      {
                        length: c[1]||0,
                        artist: c[2]||"",
                        title:  c[4]||c[3],
                        file:   c[5].trim()
                      }
                    :
                      void 0
                  )
                })
          :
            Data.split("\n")
                .filter(function(e){return!!e.trim().length})
                .filter(function(e){return"#"!==e[0]})
                .map(function(e){return {file:e.trim()}})
        )
      },
      window.M3U={name:"m3u",parse:parser};
      var playlist;
      function m3uLoad(fileM3U){
        var xhr = new XMLHttpRequest();
        xhr.overrideMimeType('text/xml; charset=iso-8859-1');
        xhr.open("GET", fileM3U);
        //xhr.overrideMimeType("audio/x-mpegurl");
        xhr.onload = parse;
        xhr.send();
      }
      m3uLoad(fileName);
      function parse () {
        playlist = M3U.parse(this.response);
        
        getSongs(playlist);
        
        onload();
      }; 
      
      
      function getSongs(files){
        var queue = [];
        var file={};
        for(var i = 0; i < files.length; i++){
          file = files[i];
          file.count=i;
          queue.push(file);
        }
        //////////////////////////////////////////
        TotalFile = file.count;
        var span=document.createElement('span');
        span.innerText="url files = "+TotalFile+" files";
        span.style='color:gold';
        document.getElementById("totalList").appendChild(span);
        //////////////////////////////////////////
        
        var process = function(){
          if(queue.length){
            var f = queue.shift();
             
//          console.log(f.title);
            var td = document.createElement('td'); 
            var tr = document.createElement('tr');
            td.innerHTML = f.artist+"- "+f.title;
            //td.innerHTML.trim();
            tr.appendChild(td);
            tr.onclick = function(e){
              if(e && e.button == 1){
                tr.parentNode.removeChild(tr);
                  
              }
              else{
                midiPlay(f.file);
                for(var i = document.querySelectorAll('.playing'), l = i.length; l--;){
                  i[l].className = '';
                }
                tr.className += ' playing';
                currentSong = tr;
                console
                
                document.title="";
                documentTitle(f.title,300,15)
                
              }
              /*****************************/
              tr.scrollIntoView({behavior: "instant", block: "nearest", inline: "nearest"})
              /*****************************/
            }
            if(document.getElementById("songtable").childNodes.length == 0) 
              tr.onclick();
              
            document.getElementById('songtable').appendChild(tr);
            process();
            var lq = queue.length;
            setTimeout(function(){
              if(queue.length == lq){
                process();
              }
            },300);
          }
          
        }
        process();
      } 
      var currentSong = 0;
      
      function nextSong(){
        try{
          currentSong.nextSibling.onclick(); 
          currentSong.scrollIntoView({behavior: "instant", block: "center", inline: "nearest"})
        }
        catch(e){
          //currentSong = document.querySelector("#songtable tr");
          currentSong = document.document.getElementsByTagNamer("tr");
          currentSong.onclick();
          
        }
      }
      function prevSong(){
        try{
          currentSong.previousSibling.onclick(); 
          currentSong.scrollIntoView({behavior: "instant", block: "center", inline: "nearest"})
        }
        catch(e){
          //currentSong = document.querySelector("#songtable tr");
          currentSong = document.getElementsByTagName("tr");
          currentSong.onclick();
          
        }
      }
      function shuffle(){
        var pt = document.getElementById('songtable');
        //fisher yates shuffle. hopefully.
        //for(var i = document.querySelectorAll("#songtable tr"), l = i.length;  l--;){
        for(var i = document.getElementsByTagName("tr"), l = i.length;  l--;){
          var j = Math.floor(Math.random() * l);
          var jel = i[j], 
              iel = i[l];
          var jref = jel.nextSibling, 
              iref = iel.nextSibling;
          pt.insertBefore(jel, iref);
          pt.insertBefore(iel, jref);
        }
        /*****************************/
        currentSong.scrollIntoView({behavior: "instant", block: "center", inline: "nearest"})
        /*****************************/
      }
      onload = function(){
        //document.querySelector('#search input').onkeydown = function(e){
        document.querySelector('input').onkeydown = function(e){
          if(e.keyCode == 13){
            //for(var i = document.querySelectorAll('#songtable tr.visible'), l = i.length; l--;){
            for(var i = document.querySelectorAll('tr.visible'), l = i.length; l--;){
              i[l].onclick();
              
            }
          }
        }
      }
      function runSearch(query){
        console.log(query);
        var regex = new RegExp(query.trim().replace(/\s+/g, '.*'), 'ig');
        for(var i = document.getElementById('songtable').getElementsByTagName('tr'), l = i.length; l--;){
          if(regex.test(i[l].innerHTML)){
            i[l].className = 'visible'
          }
          else{
            i[l].className = 'hidden';
          }
        }
      }
      var titleDoc;    
      function docTitle() {
       titleDoc = titleDoc.substring(1, titleDoc.length) + titleDoc.substring(0, 1);
       document.title = titleDoc;
       setTimeout("docTitle()", 400);
      };
      function documentTitle(FILENAME) {
        titleDoc=FILENAME+"--***--";
        docTitle();
      };
      //document.getElementById('togglesearch').innerHTML=search;
      function toggle_search(selector) {
           var butt=document.getElementById('togglesearch');
           var e = document.getElementById(selector).style;
           var se= document.getElementById('searchIn');
           if(e.display == 'block'){
              e.display = 'none';
              butt.innerHTML=search;
            }  
           else{
              e.display = 'block';
              se.focus();
              butt.innerHTML=search
           }
        };
      function toggle_showSong(selector) {
           var butt=document.getElementById('togglesong');
           var e = document.getElementById(selector).style;
           if(e.height == '80%'){
              e.height = '0%';
              butt.innerHTML='&blacktriangle;';
              butt.title='Show List';
              
            }  
           else{
              e.height = '80%';
              butt.innerHTML='&blacktriangledown;'
              butt.title='Hide List';
           }
        };
        

    </script>

<script type='text/javascript' src='js/dirkncl.js'></script>	
<script>
  
</script>

<script type='text/javascript'>
///////////////////////////////////
function fileExtension(file){
  var fileSplit=file.split(".");
  return fileSplit[fileSplit.length-1].toLowerCase();
};


/////////////////////
  /*********************this modified********************************/
var midiName=[];
var midiNameIndex;
var GetFiles=function(){
      var fileInput = document.querySelector("#myfiles");
      var files = fileInput.files;
      var fl=midiNameIndex=files.length;
      var i=0;
      while ( i < fl) {
        if(fileExtension(files[i].name=="mid"||"kar"||"midi"||"rmi")){
          midiName[i]=files[i];
        };
        i++;
      }
      var htmls="<form name='MidiForm' method='POST'><span style='font-size: 9pt'><font size='1'><select size='1' name='Pilihan'  multiple='true' style='height:150px' onchange='runMidiPlay(this.selectedIndex)' style='font-size: 9pt'>";

      for(var i=0; i<midiName.length;i++){
        htmls=htmls+"<option>"+midiName[i].name+"</option>";
      };
      //console.log('index',midiNameIndex);
      htmls=htmls+"</select></font></span></form>";
      document.getElementById('selectfile').innerHTML=htmls;
      document.MidiForm.Pilihan.selectedIndex=Math.floor(Math.random() * midiName.length);
      runMidiPlay(document.MidiForm.Pilihan.selectedIndex);
    };
//var accept=["mid","kar","midi","rmi"]   
var GetDir=function(){
      var fileInput = document.querySelector("#myDir");
      var files = fileInput.files;
      var fl=midiNameIndex=files.length;
      var i=0;
      while ( i < fl) {
          midiName[i]=files[i];
          i++
        }
      var htmls=""+
        "<form name='MidiForm' method='POST'><span style='font-size: 9pt'><font size='1'><select size='1' name='Pilihan'  multiple='true' style='height:150px' onchange='runMidiPlay(this.selectedIndex)' style='font-size: 9pt'>"+
      "";
      
      for(var i=0; i<midiName.length;i++){
        htmls=htmls+"<option>"+midiName[i].name+"</option>";
      };
      //console.log('index',midiNameIndex);
      htmls=htmls+"</select></font></span></form>";
      document.getElementById('selectfile').innerHTML=htmls;
      
      document.MidiForm.Pilihan.selectedIndex==Math.floor(Math.random() * midiName.length);
      runMidiPlay(document.MidiForm.Pilihan.selectedIndex);
    };  

var selectedFile=0;
var current = 0;
var ext;
function runMidiPlay(nr){
  ext= fileExtension(midiName[nr].name);
  document.title ='';
  selectedFile=nr;
  if(ext=="mid"||ext=="kar"||ext=="midi"||ext=="rmi"){
    midiPlay(URL.createObjectURL(midiName[nr]));
    document.MidiForm.Pilihan.selectedIndex=nr;
    documentTitle(midiName[nr].name);
  }
  else{
    PlayNext()
  }
  //document.getElementById("current").innerHTML="<marquee>"+midiName[nr].name+"</marquee>";
};

function PlayRandom(){
  document.title ='';
  var temp;
  temp=Math.floor(Math.random() * midiName.length);
  selectedFile=temp;
  current=selectedFile;
  runMidiPlay(current);
  //console.log('random' ,midiName[selectedFile].name);
  };

  function PlayNext() {
    if (current === midiName.length - 1) {
      current = 0;
    } 
    else {
      current++;
    }
    runMidiPlay(current);
  };

  function PlayPrev() {
    if (current === 0) {
      current = midiName.length - 1;
    } 
    else {
      current--;
    }
    runMidiPlay(current);
  };
  ///////////////////////////////////
  var titleDoc;    
  function docTitle() {
   titleDoc = titleDoc.substring(1, titleDoc.length) + titleDoc.substring(0, 1);
   document.title = titleDoc;
   setTimeout("docTitle()", 400);
  };
  function documentTitle(FILENAME) {
    titleDoc=FILENAME+"--***--";
    docTitle();
  };
/*********************this modified********************************/
        

</script>	
<script type='text/javascript'>

window.onload=function(){
  Mobile?(document.getElementById("mydiv").style.left="0px"):(document.getElementById("mydiv").style.left="350px");
  var time_button = document.getElementById('time_button');
    midiPlayTime = timePlay;
    //p = timePlay;
    function timePlay(e) {
       var result;
       //time_button.value=parseInt(e.time);
       var m=parseInt(e.time/60)%60;
       if(m<10)m="0"+m;
       var s=parseInt(e.time%60);
       if(s<10)s="0"+s;
       //time_button.value=m+":"+s;
       time_button.value=m+":"+s;
    };
}
</script>		

</head>
	<body style="background-color:black">
  <div id="totalList"></div>
  <pre style="position:absolute;color:gold">
  shortcut:
  [tab]       : shuffle url list
  [space]     : stop playing
  left arrow  : prev. song in url list
  right arrow : next song in url list
  up arrow    : increase volume
  down arrow  : decrease volume  
  ctrl + c    : toggle sound compressor
  ctrl + s    : search in url list
  ctrl + f    : open files for local list
  ctrl + d    : open folder for local list
  ctrl + l    : toggle show/hide url list 
  {l = lower case from L}
  </pre>		
    <!------------------------------------------------------------>
		<div style="position:absolute; bottom:2px;right:2px; z-index:1000" class="pick">
      <div>
        <label class="filebutton">Choose Dir!
          <span>
            <!--accept=".mid,.kar,.midi,.rmi"-->
            <input style="display:block" id="myDir" type="file" name="myDir"  accept=".mid,.kar,.midi,.rmi" multiple webkitdirectory onchange="GetDir()">
          </span>
        </label> or 
        
        <label class="filebutton">Choose Files!
          <span>
            <!--accept=".mid,.kar,.midi,.rmi"-->
            <input style="display:block" id="myfiles" type="file" name="myFiles" accept=".mid,.kar,.midi,.rmi" multiple onchange="GetFiles()">
          </span>
        </label>
      </div>
      <div id="selectfile" style="width:30px"></div>
      <button id='random' onclick='midiStop();'>Stop</button>
      <button id='random' onclick='PlayRandom()'>Random</button>
      <button id='prev' onclick='PlayPrev()'><<</button>
      <button id='next' onclick='PlayNext()'>>></button>
      <input id="time_button" type="button"></input>
    </div>
    
    <div id="mydiv">
      <div id="mydivheader">
      
        <div id='togglesongholder'>
          
          <div id="search">
            <input id='searchIn' type="text" placeholder="Search: song" spellcheck=off autocomplete=on oninput="runSearch(this.value)">
          </div>
          
          <a id='togglesearch' style='text-decoration:none;font-color:blue;font-size:34px' href="javascript:toggle_search('search')"><svg width='12px' class="svg-icon" viewBox="0 0 20 20"><path d="M18.125,15.804l-4.038-4.037c0.675-1.079,1.012-2.308,1.01-3.534C15.089,4.62,12.199,1.75,8.584,1.75C4.815,1.75,1.982,4.726,2,8.286c0.021,3.577,2.908,6.549,6.578,6.549c1.241,0,2.417-0.347,3.44-0.985l4.032,4.026c0.167,0.166,0.43,0.166,0.596,0l1.479-1.478C18.292,16.234,18.292,15.968,18.125,15.804 M8.578,13.99c-3.198,0-5.716-2.593-5.733-5.71c-0.017-3.084,2.438-5.686,5.74-5.686c3.197,0,5.625,2.493,5.64,5.624C14.242,11.548,11.621,13.99,8.578,13.99 M16.349,16.981l-3.637-3.635c0.131-0.11,0.721-0.695,0.876-0.884l3.642,3.639L16.349,16.981z"></path></svg></a>   
          <a id='togglesong' style='text-decoration:none;font-color:blue;font-size:34px' href="javascript:toggle_showSong('songs')">&blacktriangledown;</a>
          <a style='text-decoration:none;font-color:blue;font-size:34px' href="javascript:"> | </a>
          <a style='text-decoration:none;font-color:blue;font-size:34px' href="javascript:shuffle()"><svg class="svg-icon" viewBox="0 0 20 20"><path d="M12.319,5.792L8.836,2.328C8.589,2.08,8.269,2.295,8.269,2.573v1.534C8.115,4.091,7.937,4.084,7.783,4.084c-2.592,0-4.7,2.097-4.7,4.676c0,1.749,0.968,3.337,2.528,4.146c0.352,0.194,0.651-0.257,0.424-0.529c-0.415-0.492-0.643-1.118-0.643-1.762c0-1.514,1.261-2.747,2.787-2.747c0.029,0,0.06,0,0.09,0.002v1.632c0,0.335,0.378,0.435,0.568,0.245l3.483-3.464C12.455,6.147,12.455,5.928,12.319,5.792 M8.938,8.67V7.554c0-0.411-0.528-0.377-0.781-0.377c-1.906,0-3.457,1.542-3.457,3.438c0,0.271,0.033,0.542,0.097,0.805C4.149,10.7,3.775,9.762,3.775,8.76c0-2.197,1.798-3.985,4.008-3.985c0.251,0,0.501,0.023,0.744,0.069c0.212,0.039,0.412-0.124,0.412-0.34v-1.1l2.646,2.633L8.938,8.67z M14.389,7.107c-0.34-0.18-0.662,0.244-0.424,0.529c0.416,0.493,0.644,1.118,0.644,1.762c0,1.515-1.272,2.747-2.798,2.747c-0.029,0-0.061,0-0.089-0.002v-1.631c0-0.354-0.382-0.419-0.558-0.246l-3.482,3.465c-0.136,0.136-0.136,0.355,0,0.49l3.482,3.465c0.189,0.186,0.568,0.096,0.568-0.245v-1.533c0.153,0.016,0.331,0.022,0.484,0.022c2.592,0,4.7-2.098,4.7-4.677C16.917,9.506,15.948,7.917,14.389,7.107 M12.217,15.238c-0.251,0-0.501-0.022-0.743-0.069c-0.212-0.039-0.411,0.125-0.411,0.341v1.101l-2.646-2.634l2.646-2.633v1.116c0,0.174,0.126,0.318,0.295,0.343c0.158,0.024,0.318,0.034,0.486,0.034c1.905,0,3.456-1.542,3.456-3.438c0-0.271-0.032-0.541-0.097-0.804c0.648,0.719,1.022,1.659,1.022,2.66C16.226,13.451,14.428,15.238,12.217,15.238"></path></svg></a>
          <a style='text-decoration:none;font-color:blue;font-size:34px' href="javascript:prevSong()"> &blacktriangleleft; </a>
          <a style='text-decoration:none;font-color:blue;font-size:34px' href="javascript:nextSong()"> &blacktriangleright; </a>
          
        </div>  
        <div id="songs">
          <table id="songtable" cellspacing=0 cellpadding=0></table>
        </div>
        
      </div>
    </div>
        <script>
    
//Make the DIV element draggagle:
dragElement(document.getElementById("mydiv"));

function dragElement(elmnt) {
  var pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
  if (document.getElementById(elmnt.id + "header")) {
    /* if present, the header is where you move the DIV from:*/
    document.getElementById(elmnt.id + "header").onmousedown = dragMouseDown;
  } else {
    /* otherwise, move the DIV from anywhere inside the DIV:*/
    elmnt.onmousedown = dragMouseDown;
  }

  function dragMouseDown(e) {
    e = e || window.event;
    e.preventDefault();
    // get the mouse cursor position at startup:
    pos3 = e.clientX;
    pos4 = e.clientY;
    document.onmouseup = closeDragElement;
    // call a function whenever the cursor moves:
    document.onmousemove = elementDrag;
  }

  function elementDrag(e) {
    e = e || window.event;
    e.preventDefault();
    // calculate the new cursor position:
    pos1 = pos3 - e.clientX;
    pos2 = pos4 - e.clientY;
    pos3 = e.clientX;
    pos4 = e.clientY;
    // set the element's new position:
    elmnt.style.top = (elmnt.offsetTop - pos2) + "px";
    elmnt.style.left = (elmnt.offsetLeft - pos1) + "px";
  }

  function closeDragElement() {
    /* stop moving when mouse button is released:*/
    document.onmouseup = null;
    document.onmousemove = null;
  }
}
</script>
  </body>
</html>
