var g={};g.set=function(r,e,n){var t="";if(n){var a=new Date;a.setTime(a.getTime()+24*n*60*60*1e3),t="; expires="+a.toGMTString()}document.cookie=r+"="+e+t+"; path=/"},g.get=function(r){for(var e=r+"=",n=document.cookie.split(";"),t=0;t<n.length;t++){for(var a=n[t];" "==a.charAt(0);)a=a.substring(1,a.length);if(0==a.indexOf(e))return a.substring(e.length,a.length)}},g.t=function(r){this.set(r,"",-1)};var e=function(){function u(r,e){var n="[Output] "+r;return arguments[0]=n,console.log.apply(console,arguments)}function a(){var r=Object.keys(I),e=r[r.length-1];return I[e]}function c(r,e){a().connect(e),I[r]=e}function r(r){m=r;var e=g.get("volume");if(s=e?parseFloat(e):y,l=I.gain=m.createGain(),I.gain.gain.value=s,p){var n=m.createAnalyser();n.smoothingTimeConstant=.2,n.fftSize=2048,c("analyser_before",n)}if(d){var t=m.createDynamicsCompressor();c("compressor",t)}if(p){var n=m.createAnalyser();n.smoothingTimeConstant=.2,n.fftSize=2048,c("analyser_after",n),setInterval(o,200)}return a().connect(m.destination),l.o=f,l}function o(r){var e=new Uint8Array(I.i.frequencyBinCount);I.i.getByteFrequencyData(e);var n=new Uint8Array(I.u.frequencyBinCount);I.u.getByteFrequencyData(n);for(var t=0,a=0,c=e.length,o=0;c>o;o++)t+=e[o],a+=n[o];var f=t/c,i=a/c;u("Average volume before / after -> difference ",f,i,f-i),u("Reduction: ",I.v.reduction.value.toFixed(2))}function f(r){r.connect(l)}function e(){if(I.v)u("Disabling DynamicsCompressor."),I.v.disconnect(),delete I.v,a().connect(m.destination);else{u("Enabling DynamicsCompressor.");var r=a();r.disconnect(),I.v=m.createDynamicsCompressor(),r.connect(I.v),I.v.connect(m.destination)}}function n(r){return"undefined"==typeof r||r>1||0>r?console.log("Invalid volume!",r):(g.set("volume",r),void(I.gain.gain.value=r))}function t(){.01>=s||n(s-=.05)}function i(){s>=1.01||n(s+=.05)}function v(){return I.gain.gain.value}var m,s,l,I={},d=true,p=false,y=.8;return{m:r,s:n,l:t,I:i,p:v,g:e}}();var a="lib/curiousMidi.js";var o="../muki-io/";var f=1;var i=2;var u;var v=0;var m=Math.pow(2,13);var s;var l;var I;var t=0;var d=0;var p=0;var y;var r="";var b;u=new AudioContext;var w=e.m(u);var c=2;var n;var M=1;e.s(.8);var h=false;document.addEventListener("keydown",function(r){if(27==r.keyCode||!(h||r.ctrlKey||r.metaKey)){switch(r.keyCode){case 38:e.I();console.log(e.p());break;case 40:e.l();console.log(e.p());break}}});function D(r,e){var n=document.getElementsByTagName("script")[0],t=document.createElement("script");t.onload=function(){e()};t.onerror=function(){x("Where your script "+r);return};t.src=r;t.type="text/javascript";n.parentNode.insertBefore(t,n)}var _={};function j(r){_.time=u.currentTime-p;A(_);t=cmInterface.M(d,s,m*2);if(0==t){k();return}for(var e=0;e<m;e++){if(e<t){for(var n=0;c>n;n++){r.outputBuffer.getChannelData(n)[e]=cmInterface.h(s+2*e,cmInterface.D)/cmInterface._}}else{x("Filling 0 at end of buffer");for(var n=0;c>n;n++){r.outputBuffer.getChannelData(n)[e]=0}}}}function C(n,r,t){var a=new XMLHttpRequest;a.open("GET",r+t,true);a.responseType="arraybuffer";a.onerror=function(){x("Error: patch file none or cannot retrive "+r+t)};a.onload=function(){b--;cmInterface.j(t,cmInterface.C(a.response));x("Loading instruments: "+b);if(b==0){stream=cmInterface.L(l,I.length);var r=cmInterface.k(u.sampleRate,cmInterface.A,m*2);d=cmInterface.R(stream,r);y=cmInterface.U(stream);cmInterface.q(d);v=u.createScriptProcessor(m,f,i);s=cmInterface.F(m*2);v.onaudioprocess=j;var e=u.createGain();e.gain.value=M;v.connect(e);e.connect(w),p=u.currentTime;x("Playing: "+n+" ...")}};a.send()}function E(r){k();var e="";for(var n=0;n<document.scripts.length;n++){var t=document.scripts[n].src;e=a}for(var n=0;n<document.scripts.length;n++){var t=document.scripts[n].src;if(e==t){return}}x("Loading curiousMidi ... ");D(e,function(){L(r)})}function L(a){x("Loading MIDI file "+a+" ...");var c=new XMLHttpRequest;c.open("GET",a,true);c.responseType="arraybuffer";c.onerror=function(){x("Error: Cannot retrieve MIDI file "+a)};c.onload=function(){x("MIDI file loaded: "+a);I=cmInterface.C(c.response);l=cmInterface.F(I.length);cmInterface.G(I,l);y=cmInterface.H();stream=cmInterface.L(l,I.length);var r=cmInterface.k(u.sampleRate,cmInterface.A,m*2);d=cmInterface.R(stream,r);y=cmInterface.U(stream);b=cmInterface.O(d);if(0<b){for(var e=0;e<b;e++){var n=cmInterface.P(d,e);C(a,o+"pat/",n)}}else{cmInterface.q(d);v=u.createScriptProcessor(m,f,i);s=cmInterface.F(m*2);v.onaudioprocess=j;var t=u.createGain();t.gain.value=M;v.connect(t);t.connect(w),p=u.currentTime;x("Playing: "+a+" ...")}};c.send()}function k(){if(v){v.disconnect();v.onaudioprocess=0;v=0;cmInterface.T(s);cmInterface.T(l);cmInterface.W(d);d=0;cmInterface.X();v=0}_.time=0;A(_)}var x=function(r){console.log(r)};var A=function(r){return};var R=function(){return r};U("js/interface.js");function U(r){var e=document.getElementsByTagName("script")[0],n=document.createElement("script");n.onerror=function(){x("Where your script "+r);return};n.src=r;n.type="text/javascript";e.parentNode.insertBefore(n,e)}var q=location.search;var F="";F=decodeURIComponent(q).replace(/\+/g," ").replace("?","");if(F.indexOf("&")!=-1){F=F.split("&");F[1]="";F=F[0]}if(F!=""){E(F)} 
