function utf8(){function t(t){return 240==(240&t)?4:224==(224&t)?3:192==(192&t)?2:t==(127&t)?1:0}function e(e,r,n){var a=0,i="";if(r=r||0,e.length-r<=0)throw new Error("No more characters remaining in array.");if(0==(n=n||t(e[r])))throw new Error(e[r].toString(2)+" is not a significative byte (offset:"+r+").");if(1===n)return e[r];if(e.length-r<n)throw new Error("Expected at least "+n+" bytes remaining in array.");if(i="00000000".slice(0,n)+1+"00000000".slice(n+1),e[r]&parseInt(i,2))throw Error("Index "+r+": A "+n+" bytes encoded char cannot encode the "+(n+1)+"th rank bit to 1.");for(i="0000".slice(0,n+1)+"11111111".slice(n+1),a+=(e[r]&parseInt(i,2))<<6*--n;n;){if(128!=(128&e[r+1])||64==(64&e[r+1]))throw Error("Index "+(r+1)+': Next bytes of encoded char must begin with a "10" bit sequence.');a+=(63&e[++r])<<6*--n}return a}function r(r,n,a,i){var s,E=[];for(n|=0,a="number"==typeof a?a:r.byteLength||r.length;n<a;n++){if(n+(s=t(r[n]))>a){if(i)throw Error("Index "+n+": Found a "+s+" bytes encoded char declaration but only "+(a-n)+" bytes are available.")}else E.push(String.fromCodePoint(e(r,n,s)));n+=s-1}return E.join("")}function n(t){if(t<128)return 1;if(t<2048)return 2;if(t<65536)return 3;if(t<2097152)return 4;throw new Error("CharCode "+t+" cannot be encoded with UTF8.")}function a(t,e,r,a){if(t|=0,e=e||[],r|=0,1==(a=a||n(t)))e[r]=t;else for(e[r++]=(parseInt("1111".slice(0,a),2)<<8-a)+(t>>>6*--a);a>0;)e[r++]=t>>>6*--a&63|128;return e}UTF8={isNotUTF8:function(t,e,n){try{r(t,e,n,!0)}catch(t){return!0}return!1},getCharLength:t,getCharCode:e,getStringFromBytes:r,getBytesForCharCode:n,setBytesFromCharCode:a,setBytesFromString:function(t,e,r,i,s){t=t||"",e=e||[],r|=0,i="number"==typeof i?i:e.byteLength||1/0;for(var E=0,o=t.length;E<o;E++){var f=n(t[E].codePointAt(0));if(s&&r+f>i)throw new Error('Not enought bytes to encode the char "'+t[E]+'" at the offset "'+r+'".');a(t[E].codePointAt(0),e,r,f),r+=f}return e}}}function midievents(){function t(){throw new Error("MIDIEvents function not intended to be run.")}return t.EVENT_META=255,t.EVENT_SYSEX=240,t.EVENT_DIVSYSEX=247,t.EVENT_MIDI=8,t.EVENT_META_SEQUENCE_NUMBER=0,t.EVENT_META_TEXT=1,t.EVENT_META_COPYRIGHT_NOTICE=2,t.EVENT_META_TRACK_NAME=3,t.EVENT_META_INSTRUMENT_NAME=4,t.EVENT_META_LYRICS=5,t.EVENT_META_MARKER=6,t.EVENT_META_CUE_POINT=7,t.EVENT_META_MIDI_CHANNEL_PREFIX=32,t.EVENT_META_END_OF_TRACK=47,t.EVENT_META_SET_TEMPO=81,t.EVENT_META_SMTPE_OFFSET=84,t.EVENT_META_TIME_SIGNATURE=88,t.EVENT_META_KEY_SIGNATURE=89,t.EVENT_META_SEQUENCER_SPECIFIC=127,t.EVENT_MIDI_NOTE_OFF=8,t.EVENT_MIDI_NOTE_ON=9,t.EVENT_MIDI_NOTE_AFTERTOUCH=10,t.EVENT_MIDI_CONTROLLER=11,t.EVENT_MIDI_PROGRAM_CHANGE=12,t.EVENT_MIDI_CHANNEL_AFTERTOUCH=13,t.EVENT_MIDI_PITCH_BEND=14,t.MIDI_1PARAM_EVENTS=[t.EVENT_MIDI_PROGRAM_CHANGE,t.EVENT_MIDI_CHANNEL_AFTERTOUCH],t.MIDI_2PARAMS_EVENTS=[t.EVENT_MIDI_NOTE_OFF,t.EVENT_MIDI_NOTE_ON,t.EVENT_MIDI_NOTE_AFTERTOUCH,t.EVENT_MIDI_CONTROLLER,t.EVENT_MIDI_PITCH_BEND],t.createParser=function(e,r,n){var a,i,s,E,o;if(e instanceof DataView&&(e={position:r||0,buffer:e,readUint8:function(){return this.buffer.getUint8(this.position++)},readUint16:function(){var t=this.buffer.getUint16(this.position);return this.position=this.position+2,t},readVarInt:function(){for(var t,e=0,r=0;4>r++;){if(!(128&(t=this.readUint8())))return e+t;e+=127&t,e<<=7}throw new Error("0x"+this.position.toString(16)+": Variable integer length cannot exceed 4 bytes")},readBytes:function(t){for(var e=[];0<t;t--)e.push(this.readUint8());return e},pos:function(){return"0x"+(this.buffer.byteOffset+this.position).toString(16)},end:function(){return this.position===this.buffer.byteLength}},r=0),0<r)for(;r--;)e.readUint8();return{next:function(){if(e.end())return null;if(i={index:e.pos(),delta:e.readVarInt()},240==(240&(a=e.readUint8()))){if(a!==t.EVENT_META){if(a===t.EVENT_SYSEX||a===t.EVENT_DIVSYSEX)return i.type=a,i.length=e.readVarInt(),i.data=e.readBytes(i.length),i;if(n)throw new Error(e.pos()+" Unknown event type "+a.toString(16)+", Delta: "+i.delta+".");return i.type=a,i.badsubtype=e.readVarInt(),i.length=e.readUint8(),i.data=e.readBytes(i.length),i}switch(i.type=t.EVENT_META,i.subtype=e.readUint8(),i.length=e.readVarInt(),i.subtype){case t.EVENT_META_SEQUENCE_NUMBER:if(n&&2!==i.length)throw new Error(e.pos()+" Bad metaevent length.");return i.msb=e.readUint8(),i.lsb=e.readUint8(),i;case t.EVENT_META_TEXT:case t.EVENT_META_COPYRIGHT_NOTICE:case t.EVENT_META_TRACK_NAME:case t.EVENT_META_INSTRUMENT_NAME:case t.EVENT_META_LYRICS:case t.EVENT_META_MARKER:case t.EVENT_META_CUE_POINT:return i.data=e.readBytes(i.length),i;case t.EVENT_META_MIDI_CHANNEL_PREFIX:if(n&&1!==i.length)throw new Error(e.pos()+" Bad metaevent length.");return i.prefix=e.readUint8(),i;case t.EVENT_META_END_OF_TRACK:if(n&&0!==i.length)throw new Error(e.pos()+" Bad metaevent length.");return i;case t.EVENT_META_SET_TEMPO:if(n&&3!==i.length)throw new Error(e.pos()+" Tempo meta event length must be 3.");return i.tempo=(e.readUint8()<<16)+(e.readUint8()<<8)+e.readUint8(),i.tempoBPM=6e7/i.tempo,i;case t.EVENT_META_SMTPE_OFFSET:if(n&&5!==i.length)throw new Error(e.pos()+" Bad metaevent length.");if(i.hour=e.readUint8(),n&&23<i.hour)throw new Error(e.pos()+" SMTPE offset hour value must be part of 0-23.");if(i.minutes=e.readUint8(),n&&59<i.minutes)throw new Error(e.pos()+" SMTPE offset minutes value must be part of 0-59.");if(i.seconds=e.readUint8(),n&&59<i.seconds)throw new Error(e.pos()+" SMTPE offset seconds value must be part of 0-59.");if(i.frames=e.readUint8(),n&&30<i.frames)throw new Error(e.pos()+" SMTPE offset frames value must be part of 0-30.");if(i.subframes=e.readUint8(),n&&99<i.subframes)throw new Error(e.pos()+" SMTPE offset subframes value must be part of 0-99.");return i;case t.EVENT_META_KEY_SIGNATURE:if(n&&2!==i.length)throw new Error(e.pos()+" Bad metaevent length.");if(i.key=e.readUint8(),n&&(-7>i.key||7<i.key))throw new Error(e.pos()+" Bad metaevent length.");if(i.scale=e.readUint8(),n&&0!==i.scale&&1!==i.scale)throw new Error(e.pos()+" Key signature scale value must be 0 or 1.");return i;case t.EVENT_META_TIME_SIGNATURE:if(n&&4!==i.length)throw new Error(e.pos()+" Bad metaevent length.");return i.data=e.readBytes(i.length),i.param1=i.data[0],i.param2=i.data[1],i.param3=i.data[2],i.param4=i.data[3],i;case t.EVENT_META_SEQUENCER_SPECIFIC:return i.data=e.readBytes(i.length),i;default:if(n)throw new Error(e.pos()+" Unknown meta event type ("+i.subtype.toString(16)+").");return i.data=e.readBytes(i.length),i}}else{if(0==(128&a)){if(!s)throw new Error(e.pos()+" Running status without previous event");o=a}else s=a>>4,E=15&a,o=e.readUint8();switch(i.type=t.EVENT_MIDI,i.subtype=s,i.channel=E,i.param1=o,s){case t.EVENT_MIDI_NOTE_OFF:return i.param2=e.readUint8(),i;case t.EVENT_MIDI_NOTE_ON:return i.param2=e.readUint8(),i.param2||(i.subtype=t.EVENT_MIDI_NOTE_OFF,i.param2=127),i;case t.EVENT_MIDI_NOTE_AFTERTOUCH:case t.EVENT_MIDI_CONTROLLER:return i.param2=e.readUint8(),i;case t.EVENT_MIDI_PROGRAM_CHANGE:case t.EVENT_MIDI_CHANNEL_AFTERTOUCH:return i;case t.EVENT_MIDI_PITCH_BEND:return i.param2=e.readUint8(),i;default:if(n)throw new Error(e.pos()+" Unknown MIDI event type ("+s.toString(16)+").");return i}}}}},t.writeToTrack=function(e,r,n){var a,i,s,E,o=0;for(a=0,i=e.length;a<i;a++){if(e[a].delta>>>28)throw Error("Event #"+a+": Maximum delta time value reached ("+e[a].delta+"/134217728 max)");if(e[a].delta>>>21&&(r[o++]=e[a].delta>>>21&127|128),e[a].delta>>>14&&(r[o++]=e[a].delta>>>14&127|128),e[a].delta>>>7&&(r[o++]=e[a].delta>>>7&127|128),r[o++]=127&e[a].delta,e[a].type===t.EVENT_MIDI)r[o++]=(e[a].subtype<<4)+e[a].channel,r[o++]=e[a].param1,-1!==t.MIDI_2PARAMS_EVENTS.indexOf(e[a].subtype)&&(r[o++]=e[a].param2);else{if(r[o++]=e[a].type,e[a].type===t.EVENT_META&&(r[o++]=e[a].subtype),e[a].length>>>28)throw Error("Event #"+a+": Maximum length reached ("+e[a].length+"/134217728 max)");if(e[a].length>>>21&&(r[o++]=e[a].length>>>21&127|128),e[a].length>>>14&&(r[o++]=e[a].length>>>14&127|128),e[a].length>>>7&&(r[o++]=e[a].length>>>7&127|128),r[o++]=127&e[a].length,e[a].type===t.EVENT_META)switch(e[a].subtype){case t.EVENT_META_SEQUENCE_NUMBER:r[o++]=e[a].msb,r[o++]=e[a].lsb;break;case t.EVENT_META_TEXT:case t.EVENT_META_COPYRIGHT_NOTICE:case t.EVENT_META_TRACK_NAME:case t.EVENT_META_INSTRUMENT_NAME:case t.EVENT_META_LYRICS:case t.EVENT_META_MARKER:case t.EVENT_META_CUE_POINT:for(s=0,E=e[a].length;s<E;s++)r[o++]=e[a].data[s];break;case t.EVENT_META_MIDI_CHANNEL_PREFIX:r[o++]=e[a].prefix;break;case t.EVENT_META_END_OF_TRACK:break;case t.EVENT_META_SET_TEMPO:r[o++]=e[a].tempo>>16,r[o++]=e[a].tempo>>8&255,r[o++]=255&e[a].tempo;break;case t.EVENT_META_SMTPE_OFFSET:if(n&&23<e[a].hour)throw new Error("Event #"+a+": SMTPE offset hour value must be part of 0-23.");if(r[o++]=e[a].hour,n&&59<e[a].minutes)throw new Error("Event #"+a+": SMTPE offset minutes value must be part of 0-59.");if(r[o++]=e[a].minutes,n&&59<e[a].seconds)throw new Error("Event #"+a+": SMTPE offset seconds value must be part of 0-59.");if(r[o++]=e[a].seconds,n&&30<e[a].frames)throw new Error("Event #"+a+": SMTPE offset frames amount must be part of 0-30.");if(r[o++]=e[a].frames,n&&99<e[a].subframes)throw new Error("Event #"+a+": SMTPE offset subframes amount must be part of 0-99.");r[o++]=e[a].subframes;break;case t.EVENT_META_KEY_SIGNATURE:if("number"!=typeof e[a].key||-7>e[a].key||7<e[a].scale)throw new Error("Event #"+a+":The key signature key must be between -7 and 7");if("number"!=typeof e[a].scale||0>e[a].scale||1<e[a].scale)throw new Error("Event #"+a+":The key signature scale must be 0 or 1");r[o++]=e[a].key,r[o++]=e[a].scale;break;case t.EVENT_META_TIME_SIGNATURE:case t.EVENT_META_SEQUENCER_SPECIFIC:default:for(s=0,E=e[a].length;s<E;s++)r[o++]=e[a].data[s]}else for(s=0,E=e[a].length;s<E;s++)r[o++]=e[a].data[s]}}},t.getRequiredBufferLength=function(e){var r,n=0,a=0;for(a=0,r=e.length;a<r;a++)n+=e[a].delta>>>21?4:e[a].delta>>>14?3:e[a].delta>>>7?2:1,e[a].type===t.EVENT_MIDI?(n++,n++,-1!==t.MIDI_2PARAMS_EVENTS.indexOf(e[a].subtype)&&n++):(n++,e[a].type===t.EVENT_META&&n++,n+=e[a].length>>>21?4:e[a].length>>>14?3:e[a].length>>>7?2:1,n+=e[a].length);return n},t}function midi_file_track(){function t(e,r){let n,a;if(e){if(!(e instanceof ArrayBuffer))throw new Error("Invalid buffer received.");if(12>e.byteLength-r)throw new Error("Invalid MIDIFileTrack (0x"+r.toString(16)+") : Buffer length must size at least 12bytes");if(this.datas=new DataView(e,r,t.HDR_LENGTH),"M"!==String.fromCharCode(this.datas.getUint8(0))||"T"!==String.fromCharCode(this.datas.getUint8(1))||"r"!==String.fromCharCode(this.datas.getUint8(2))||"k"!==String.fromCharCode(this.datas.getUint8(3)))throw new Error("Invalid MIDIFileTrack (0x"+r.toString(16)+") : MTrk prefix not found");if(a=this.getTrackLength(),e.byteLength-r<a)throw new Error("Invalid MIDIFileTrack (0x"+r.toString(16)+") : The track size exceed the buffer length.");if(this.datas=new DataView(e,r,t.HDR_LENGTH+a),255!==this.datas.getUint8(t.HDR_LENGTH+(a-3))||47!==this.datas.getUint8(t.HDR_LENGTH+(a-2))||0!==this.datas.getUint8(t.HDR_LENGTH+(a-1)))throw new Error("Invalid MIDIFileTrack (0x"+r.toString(16)+") : No track end event found at the expected index ("+(t.HDR_LENGTH+(a-1)).toString(16)+").")}else(n=new Uint8Array(12))[0]=77,n[1]=84,n[2]=114,n[3]=107,n[4]=0,n[5]=0,n[6]=0,n[7]=4,n[8]=0,n[9]=255,n[10]=47,n[11]=0,this.datas=new DataView(n.buffer,0,t.HDR_LENGTH+4)}return t.HDR_LENGTH=8,t.prototype.getTrackLength=function(){return this.datas.getUint32(4)},t.prototype.setTrackLength=function(t){return this.datas.setUint32(4,t)},t.prototype.getTrackContent=function(){return new DataView(this.datas.buffer,this.datas.byteOffset+t.HDR_LENGTH,this.datas.byteLength-t.HDR_LENGTH)},t.prototype.setTrackContent=function(e){let r,n,a,i;const s=e.byteLength-e.byteOffset;if(4>s)throw new Error("Invalid track length, must size at least 4bytes");for(this.datas=new DataView(new Uint8Array(t.HDR_LENGTH+s).buffer),this.datas.setUint8(0,77),this.datas.setUint8(1,84),this.datas.setUint8(2,114),this.datas.setUint8(3,107),this.datas.setUint32(4,s),r=new Uint8Array(e.buffer,e.byteOffset,e.byteLength),n=new Uint8Array(this.datas.buffer,t.HDR_LENGTH,s),a=0,i=r.length;a<i;a++)n[a]=r[a]},t}function midi_file_header(){function t(e){let r;if(e){if(!(e instanceof ArrayBuffer))throw Error("Invalid buffer received.");if(this.datas=new DataView(e,0,t.HEADER_LENGTH),"M"!==String.fromCharCode(this.datas.getUint8(0))||"T"!==String.fromCharCode(this.datas.getUint8(1))||"h"!==String.fromCharCode(this.datas.getUint8(2))||"d"!==String.fromCharCode(this.datas.getUint8(3)))throw new Error("Invalid MIDIFileHeader : MThd prefix not found");if(6!==this.datas.getUint32(4))throw new Error("Invalid MIDIFileHeader : Chunk length must be 6")}else(r=new Uint8Array(t.HEADER_LENGTH))[0]=77,r[1]=84,r[2]=104,r[3]=100,r[4]=0,r[5]=0,r[6]=0,r[7]=6,r[8]=0,r[9]=1,r[10]=0,r[11]=1,r[12]=0,r[13]=192,this.datas=new DataView(r.buffer,0,t.HEADER_LENGTH)}return t.HEADER_LENGTH=14,t.FRAMES_PER_SECONDS=1,t.TICKS_PER_BEAT=2,t.prototype.getFormat=function(){const t=this.datas.getUint16(8);if(0!==t&&1!==t&&2!==t)throw new Error("Invalid MIDI file : MIDI format ("+t+"), format can be 0, 1 or 2 only.");return t},t.prototype.setFormat=function(t){if(0!==t&&1!==t&&2!==t)throw new Error("Invalid MIDI format given ("+t+"), format can be 0, 1 or 2 only.");this.datas.setUint16(8,t)},t.prototype.getTracksCount=function(){return this.datas.getUint16(10)},t.prototype.setTracksCount=function(t){return this.datas.setUint16(10,t)},t.prototype.getTickResolution=function(t){return 32768&this.datas.getUint16(12)?1e6/(this.getSMPTEFrames()*this.getTicksPerFrame()):(t=t||5e5)/this.getTicksPerBeat()},t.prototype.getTimeDivision=function(){return 32768&this.datas.getUint16(12)?t.FRAMES_PER_SECONDS:t.TICKS_PER_BEAT},t.prototype.getTicksPerBeat=function(){var t=this.datas.getUint16(12);if(32768&t)throw new Error("Time division is not expressed as ticks per beat.");return t},t.prototype.setTicksPerBeat=function(t){this.datas.setUint16(12,32767&t)},t.prototype.getSMPTEFrames=function(){const t=this.datas.getUint16(12);let e;if(!(32768&t))throw new Error("Time division is not expressed as frames per seconds.");if(-1===[24,25,29,30].indexOf(e=32512&t))throw new Error("Invalid SMPTE frames value ("+e+").");return 29===e?29.97:e},t.prototype.getTicksPerFrame=function(){const t=this.datas.getUint16(12);if(!(32768&t))throw new Error("Time division is not expressed as frames per seconds.");return 255&t},t.prototype.setSMTPEDivision=function(t,e){if(29.97===t&&(t=29),-1===[24,25,29,30].indexOf(t))throw new Error("Invalid SMPTE frames value given ("+t+").");if(0>e||255<e)throw new Error("Invalid ticks per frame value given ("+t+").");this.datas.setUint8(12,128|t),this.datas.setUint8(13,e)},t}function midi_file(){var t=midi_file_header(),e=midi_file_track(),r=midievents(),n=utf8();function a(r,n){var a,i,s,E;if(r){if(25>(r=function(t){if(t){if(t instanceof ArrayBuffer)return t;if(t instanceof Uint8Array)return new Uint8Array(t).buffer}throw new Error("Unsupported buffer type, need ArrayBuffer or Uint8Array")}(r)).byteLength)throw new Error("A buffer of a valid MIDI file must have, at least, a size of 25bytes.");for(this.header=new t(r,n),this.tracks=[],i=t.HEADER_LENGTH,s=0,E=this.header.getTracksCount();s<E;s++){if(n&&i>=r.byteLength-1)throw new Error("Couldn't find datas corresponding to the track #"+s+".");a=new e(r,i,n),this.tracks.push(a),i+=a.getTrackLength()+8}if(n&&i!==r.byteLength)throw new Error("It seems that the buffer contains too much datas.")}else this.header=new t,this.tracks=[new e]}return a.prototype.getEvents=function(t,e){var n,a,i,s,E,o,f=0,h=[],T=this.header.getFormat(),d=this.header.getTickResolution();if(1!==T||1===this.tracks.length)for(i=0,s=this.tracks.length;i<s;i++)for(f=2===T&&f?f:0,a=(n=r.createParser(this.tracks[i].getTrackContent(),0,!1)).next();a;)f+=a.delta?a.delta*d/1e3:0,a.type===r.EVENT_META&&a.subtype===r.EVENT_META_SET_TEMPO&&(d=this.header.getTickResolution(a.tempo)),t&&a.type!==t||e&&(!a.subtype||a.subtype!==e)||(a.playTime=f,h.push(a)),a=n.next();else{for(E=[],o=-1,i=0,s=this.tracks.length;i<s;i++)E[i]={},E[i].parser=r.createParser(this.tracks[i].getTrackContent(),0,!1),E[i].curEvent=E[i].parser.next();do{for(o=-1,i=0,s=E.length;i<s;i++)E[i].curEvent&&(-1===o||E[i].curEvent.delta<E[o].curEvent.delta)&&(o=i);if(-1!==o){for(i=0,s=E.length;i<s;i++)i!==o&&E[i].curEvent&&(E[i].curEvent.delta-=E[o].curEvent.delta);f+=(a=E[o].curEvent).delta?a.delta*d/1e3:0,a.type===r.EVENT_META&&a.subtype===r.EVENT_META_SET_TEMPO&&(d=this.header.getTickResolution(a.tempo)),t&&a.type!==t||e&&(!a.subtype||a.subtype!==e)||(a.playTime=f,a.track=o,h.push(a)),E[o].curEvent=E[o].parser.next()}}while(-1!==o)}return h},a.prototype.getMidiEvents=function(){return this.getEvents(r.EVENT_MIDI)},a.prototype.getLyrics=function(){var t,e,a,i=this.getEvents(r.EVENT_META),s=[],E=[];for(e=0,a=i.length;e<a;e++)(t=i[e]).subtype===r.EVENT_META_LYRICS?E.push(t):t.subtype===r.EVENT_META_TEXT&&("@"===String.fromCharCode(t.data[0])?"T"===String.fromCharCode(t.data[1])||"I"===String.fromCharCode(t.data[1])||String.fromCharCode(t.data[1]):0===String.fromCharCode.apply(String,t.data).indexOf("words")?s.length=0:0!==t.playTime&&s.push(t));2<E.length?s=E:s.length||(s=[]);try{s.forEach(function(t){t.text=n.getStringFromBytes(t.data,0,t.length,!0)})}catch(t){s.forEach(function(t){t.text=t.data.map(function(t){return String.fromCharCode(t)}).join("")})}return s},a.prototype.getTrackEvents=function(t){var e,n,a=[];if(t>this.tracks.length||0>t)throw Error("Invalid track index ("+t+")");e=(n=r.createParser(this.tracks[t].getTrackContent(),0,!1)).next();do{a.push(e),e=n.next()}while(e);return a},a.prototype.setTrackEvents=function(t,e){var n,a;if(t>this.tracks.length||0>t)throw Error("Invalid track index ("+t+")");if(!e||!e.length)throw Error("A track must contain at least one event, none given.");n=r.getRequiredBufferLength(e),a=new Uint8Array(n),r.writeToTrack(e,a),this.tracks[t].setTrackContent(a)},a.prototype.deleteTrack=function(t){if(t>this.tracks.length||0>t)throw Error("Invalid track index ("+t+")");this.tracks.splice(t,1),this.header.setTracksCount(this.tracks.length)},a.prototype.addTrack=function(t){var r;if(t>this.tracks.length||0>t)throw Error("Invalid track index ("+t+")");r=new e,t===this.tracks.length?this.tracks.push(r):this.tracks.splice(t,0,r),this.header.setTracksCount(this.tracks.length)},a.prototype.getContent=function(){var e,r,n,a,i,s,E,o,f;for(e=t.HEADER_LENGTH,a=0,i=this.tracks.length;a<i;a++)e+=this.tracks[a].getTrackLength()+8;for(r=new Uint8Array(e),n=new Uint8Array(this.header.datas.buffer,this.header.datas.byteOffset,t.HEADER_LENGTH),a=0,i=t.HEADER_LENGTH;a<i;a++)r[a]=n[a];for(s=0,E=this.tracks.length;s<E;s++)for(n=new Uint8Array(this.tracks[s].datas.buffer,this.tracks[s].datas.byteOffset,this.tracks[s].datas.byteLength),o=0,f=this.tracks[s].datas.byteLength;o<f;o++)r[a++]=n[o];return r.buffer},a.Header=t,a.Track=e,a}var GetMidiLyrics=function(t,e){var r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType="arraybuffer",r.onload=function(){e(r.response)},r.send(null)},MIDIFile=midi_file();window.GetMidiLyrics=GetMidiLyrics;